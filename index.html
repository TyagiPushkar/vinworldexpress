<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIN WORLD - Volumetric Weight Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f7f9fc;
            color: #002d62;
            /* Navy */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .calculator {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 30px 40px;
            width: 95%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
        }

        /* Logo */
        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            justify-content: center;
        }

        .logo img {
            height: 60px;
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 22px;
            font-weight: bold;
            color: #f7931d;
            /* Orange */
        }

        h2 {
            margin-bottom: 20px;
            color: #002d62;
            text-align: center;
        }

        /* Form grid */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        button {
            background: #f7931d;
            border: none;
            color: white;
            cursor: pointer;
            padding: 12px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
            margin-top: 10px;
            width: 100%;
        }

        button:hover {
            background: #e67e00;
        }

        .result {
            margin-top: 20px;
            width: 100%;
            text-align: center;
            background: #eaf3ff;
            border: 2px solid #002d62;
            border-radius: 10px;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #002d62;
        }

        .price-details {
            margin-top: 20px;
            display: none;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #ddd;
        }

        .price-details h3 {
            color: #002d62;
            margin-bottom: 15px;
            text-align: center;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .price-table th,
        .price-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .price-table th {
            background-color: #eaf3ff;
        }

        .price-table tr:last-child td {
            border-bottom: none;
            font-weight: bold;
            color: #f7931d;
        }

        .loader {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        .loader:after {
            content: " ";
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid #ccc;
            border-color: #ccc transparent #ccc transparent;
            animation: loader 1.2s linear infinite;
        }

        @keyframes loader {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error {
            color: red;
            margin-top: 10px;
            text-align: center;
            display: none;
        }

        .invoice-input {
            display: none;
        }
    </style>
</head>

<body>
    <div class="calculator">
        <!-- Logo Section -->
        <div class="logo">
            <img src="https://vinworldexpress.com/assets/img/resource/logo-4.png" alt="VIN WORLD Logo">
            <h1>Freight Calculator</h1>
        </div>

        <h2>Calculate Chargeable Weight</h2>

        <div class="form-row">
            <div class="form-group">
                <label for="mode">Courier Mode</label>
                <select id="mode">
                    <option value="air">Air</option>
                    <option value="surface">Surface</option>
                </select>
            </div>
            <div class="form-group">
                <label for="gross">Gross Weight (Kg)</label>
                <input type="number" id="gross" placeholder="Enter Gross Weight">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="length">Length (cm)</label>
                <input type="number" id="length" placeholder="Enter Length">
            </div>
            <div class="form-group">
                <label for="breadth">Width (cm)</label>
                <input type="number" id="breadth" placeholder="Enter Width">
            </div>
            <div class="form-group">
                <label for="height">Height (cm)</label>
                <input type="number" id="height" placeholder="Enter Height">
            </div>
        </div>

        <div class="form-row" id="pincode-row" style="display: none;">
            <div class="form-group">
                <label for="pincode">Destination Pincode (Surface only)</label>
                <input type="text" id="pincode" placeholder="Enter Pincode" maxlength="6">
            </div>
        </div>

        <div class="form-row invoice-input" id="invoice-row">
            <div class="form-group">
                <label for="invoice">Invoice Value (‚Çπ) - For FOV Calculation</label>
                <input type="number" id="invoice" placeholder="Enter Invoice Value" value="0">
            </div>
        </div>

        <button onclick="calculateWeight()">Calculate</button>
        <div class="loader" id="loader"></div>
        <div class="error" id="error"></div>
        <div id="result" class="result" style="display: none;"></div>
        <div id="price-details" class="price-details"></div>
    </div>

    <script>
        // Show/hide pincode field based on mode selection
        document.getElementById('mode').addEventListener('change', function () {
            const pincodeRow = document.getElementById('pincode-row');
            const invoiceRow = document.getElementById('invoice-row');
            const isSurface = this.value === 'surface';

            pincodeRow.style.display = isSurface ? 'flex' : 'none';
            invoiceRow.style.display = isSurface ? 'flex' : 'none';
        });

        async function calculateWeight() {
            const mode = document.getElementById("mode").value;
            const length = parseFloat(document.getElementById("length").value);
            const breadth = parseFloat(document.getElementById("breadth").value);
            const height = parseFloat(document.getElementById("height").value);
            const gross = parseFloat(document.getElementById("gross").value);
            const pincode = document.getElementById("pincode").value;
            const invoiceValue = parseFloat(document.getElementById("invoice").value) || 0;

            // Reset previous results
            document.getElementById("result").style.display = "none";
            document.getElementById("price-details").style.display = "none";
            document.getElementById("error").style.display = "none";

            // Validation
            if (isNaN(length) || isNaN(breadth) || isNaN(height) || isNaN(gross)) {
                showError("‚ö†Ô∏è Please fill all fields correctly.");
                return;
            }

            if (mode === "surface" && (!pincode || pincode.length !== 6)) {
                showError("‚ö†Ô∏è Please enter a valid 6-digit pincode for surface calculation.");
                return;
            }

            let divisor = (mode === "air") ? 5000 : 4000;
            let volumetric = (length * breadth * height) / divisor;
            volumetric = parseFloat(volumetric.toFixed(2));

            let chargeable = Math.max(volumetric, gross);
            chargeable = Math.ceil(chargeable); // Round up to next whole number

            // Display weight result
            document.getElementById("result").style.display = "block";
            document.getElementById("result").innerHTML = `
                üì¶ Volumetric Weight: <b>${volumetric.toFixed(2)} Kg</b><br>
                ‚öñÔ∏è Gross Weight: <b>${gross.toFixed(2)} Kg</b><br><hr>
                ‚úÖ Chargeable Weight: <b style="color:#f7931d">${chargeable} Kg</b>
            `;

            // Calculate price for surface mode
            if (mode === "surface") {
                document.getElementById("loader").style.display = "block";
                try {
                    await calculatePrice(pincode, chargeable, invoiceValue);
                } catch (error) {
                    showError("Error calculating price: " + error.message);
                } finally {
                    document.getElementById("loader").style.display = "none";
                }
            }
        }

        async function calculatePrice(pincode, chargeableWeight, invoiceValue) {
            try {
                // Step 1: Get state info from pincode
                const pincodeResponse = await fetch(`https://namami-infotech.com/vinworld/src/pincode/get_pincode.php?pincode=${pincode}`);
                const pincodeData = await pincodeResponse.json();

                if (!pincodeData.success) {
                    throw new Error("Pincode not found");
                }

                const stateName = pincodeData.data[0].State_Name;
                const isODA = parseInt(pincodeData.data[0].ODA) === 1;

                // Step 2: Get zone from state
                const zoneResponse = await fetch(`https://namami-infotech.com/vinworld/src/pincode/get_zone.php?StateName=${encodeURIComponent(stateName)}`);
                const zoneData = await zoneResponse.json();

                if (!zoneData.success) {
                    throw new Error("Zone not found for this state");
                }

                const zone = zoneData.data[0].Zone;

                // Step 3: Get price from zone
                const priceResponse = await fetch(`https://namami-infotech.com/vinworld/src/pincode/get_price.php?Zone=${zone}`);
                const priceData = await priceResponse.json();

                if (!priceData.success) {
                    throw new Error("Price not found for this zone");
                }

                const priceInfo = priceData.data[0];
                let freight, odaCharge = 0;

                // Calculate base freight (same for both ODA and non-ODA)
                const pricePerKg = parseFloat(priceInfo.Price);
                freight = chargeableWeight * pricePerKg;

                // For ODA areas, add ODA charge based on weight slabs
                if (isODA) {
                    if (chargeableWeight <= 10) {
                        odaCharge = parseFloat(priceInfo.ODA0_10);
                    } else if (chargeableWeight <= 50) {
                        odaCharge = parseFloat(priceInfo.ODA11_50);
                    } else if (chargeableWeight <= 200) {
                        odaCharge = parseFloat(priceInfo.ODA51_200);
                    } else if (chargeableWeight <= 1000) {
                        odaCharge = parseFloat(priceInfo.ODA201_1000);
                    } else {
                        odaCharge = parseFloat(priceInfo.ODA1001_5000);
                    }
                }

                // Calculate additional charges
                const docketCharge = 100;

                // FOV charge (if invoice value < 50000 then 100, else 0.2% of invoice value)
                const fovCharge = invoiceValue < 50000 ? 100 : invoiceValue * 0.002;

                // Calculate subtotal before fuel surcharge
                const subtotalBeforeFSC = freight + odaCharge + docketCharge + fovCharge;

                // Fuel surcharge (15% of subtotal before FSC)
                const fuelSurcharge = subtotalBeforeFSC * 0.15;

                // Subtotal after fuel surcharge
                const subtotal = subtotalBeforeFSC + fuelSurcharge;

                // GST (18% of subtotal)
                const gst = subtotal * 0.18;

                // Total
                const total = subtotal + gst;

                // Display price details
                displayPriceDetails({
                    state: stateName,
                    zone: zone,
                    isODA: isODA,
                    freight: freight.toFixed(2),
                    odaCharge: odaCharge.toFixed(2),
                    docketCharge: docketCharge.toFixed(2),
                    fovCharge: fovCharge.toFixed(2),
                    fuelSurcharge: fuelSurcharge.toFixed(2),
                    subtotal: subtotal.toFixed(2),
                    gst: gst.toFixed(2),
                    total: total.toFixed(2)
                });

            } catch (error) {
                showError("Error calculating price: " + error.message);
                throw error;
            }
        }

        function displayPriceDetails(priceData) {
            const priceDetails = document.getElementById("price-details");

            let odaRow = '';
            if (priceData.isODA) {
                odaRow = `<tr>
                    <td>ODA Charges</td>
                    <td>${priceData.odaCharge}</td>
                </tr>`;
            }

            priceDetails.innerHTML = `
                <h3>Price Calculation Details</h3>
                <p><strong>State:</strong> ${priceData.state} | <strong>Zone:</strong> ${priceData.zone} | <strong>ODA:</strong> ${priceData.isODA ? 'Yes' : 'No'}</p>
                <table class="price-table">
                    <tr>
                        <th>Description</th>
                        <th>Amount (‚Çπ)</th>
                    </tr>
                    <tr>
                        <td>Freight Charges</td>
                        <td>${priceData.freight}</td>
                    </tr>
                    ${odaRow}
                    <tr>
                        <td>Docket Charges</td>
                        <td>${priceData.docketCharge}</td>
                    </tr>
                    <tr>
                        <td>FOV Charges</td>
                        <td>${priceData.fovCharge}</td>
                    </tr>
                    <tr>
                        <td>Subtotal</td>
                        <td>${(parseFloat(priceData.freight) + parseFloat(priceData.odaCharge) + parseFloat(priceData.docketCharge) + parseFloat(priceData.fovCharge)).toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td>Fuel Surcharge (15%)</td>
                        <td>${priceData.fuelSurcharge}</td>
                    </tr>
                    <tr>
                        <td>Subtotal before GST</td>
                        <td>${priceData.subtotal}</td>
                    </tr>
                    <tr>
                        <td>GST (18%)</td>
                        <td>${priceData.gst}</td>
                    </tr>
                    <tr>
                        <td>Total Amount</td>
                        <td>${priceData.total}</td>
                    </tr>
                </table>
            `;
            priceDetails.style.display = "block";
        }

        function showError(message) {
            const errorDiv = document.getElementById("error");
            errorDiv.textContent = message;
            errorDiv.style.display = "block";
        }
    </script>
</body>

</html>